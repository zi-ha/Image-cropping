# 🖼️ 图片尺寸调整工具

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![PySide6](https://img.shields.io/badge/PySide6-6.0+-green.svg)](https://pypi.org/project/PySide6/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Windows-lightgrey.svg)](https://www.microsoft.com/windows)

一个功能强大、界面现代化的批量图片尺寸调整工具，基于 PySide6 构建，支持多种调整模式和文件拖放操作。

## ✨ 主要特性

### 🎨 现代化界面
- **PySide6 驱动**：采用最新的 Qt6 框架，界面美观现代
- **响应式设计**：支持窗口缩放和自适应布局
- **拖放支持**：直接拖拽图片文件或文件夹到程序中
- **实时预览**：表格显示文件信息和目标尺寸
- **进度反馈**：实时进度条和详细处理日志

### 🔧 强大功能
- **批量处理**：同时处理多张图片，提高工作效率
- **🚀 多进程加速**：支持多进程并行处理，大幅提升处理速度
- **多种调整模式**：
  - 🔄 **拉伸模式**：直接拉伸到目标尺寸
  - 📐 **保持比例**：保持宽高比，空白区域填充白色
  - ✂️ **智能裁剪**：保持比例，裁剪多余部分
- **格式支持**：JPG、PNG、BMP、TIFF、WebP
- **质量控制**：可调节输出质量（50%-100%）
- **安全处理**：自动添加后缀，避免覆盖原文件

## 🚀 快速开始

### 系统要求
- Python 3.8 或更高版本
- Windows 操作系统
- 至少 100MB 可用磁盘空间

### 安装依赖
```bash
# 克隆或下载项目后，安装依赖
pip install -r requirements.txt
```

### 运行程序
```bash
# 方式一：直接运行
python main.py

# 方式二：使用打包好的 EXE（推荐）
# 运行 build_exe.py 生成可执行文件
python build_exe.py
```

## 📖 使用指南

### 基本操作流程

1. **添加图片** 📁
   - 拖拽文件/文件夹到拖放区域
   - 或点击"选择文件"/"选择文件夹"按钮

2. **设置参数** ⚙️
   - 目标宽度和高度（像素）
   - 选择调整模式
   - 设置图片质量
   - 🚀 **选择处理模式**：
     - **多进程处理（推荐）**：利用多核CPU并行处理，速度更快
     - **单进程处理**：传统串行处理，兼容性更好
   - 📊 **调整进程数**：根据CPU核心数优化性能

3. **选择输出** 📂
   - 点击"选择输出目录"
   - 选择保存位置

4. **开始处理** 🎯
   - 点击"开始处理"按钮
   - 查看实时进度和日志

### 调整模式详解

| 模式 | 说明 | 适用场景 |
|------|------|----------|
| 🔄 拉伸 | 直接拉伸到目标尺寸，可能改变比例 | 不在意比例变化的场景 |
| 📐 保持比例 | 保持原始比例，空白处填充白色 | 需要保持图片完整性 |
| ✂️ 裁剪 | 保持比例，裁剪多余部分填满目标尺寸 | 需要填满指定尺寸 |

## 🏗️ 项目架构

```
图片尺寸调整/
├── 📄 main.py              # 程序入口
├── 🖥️ gui_pyside6.py       # PySide6 用户界面
├── 🔧 image_processor.py   # 图片处理核心
├── 📁 file_manager.py      # 文件管理模块
├── 🔨 build_exe.py         # EXE 打包脚本
├── 📋 requirements.txt     # 依赖列表
├── 🖼️ logo.ico            # 应用图标
├── ⚙️ build.spec          # PyInstaller 配置
├── 📚 打包优化指南.md       # 打包说明
└── 📖 README.md           # 项目文档
```

### 模块职责

- **🔧 image_processor.py**：图片处理算法和核心逻辑
- **📁 file_manager.py**：文件选择、验证和路径管理
- **🖥️ gui_pyside6.py**：用户界面和交互逻辑
- **📄 main.py**：程序入口和模块协调

## 🛠️ 技术栈

- **界面框架**：PySide6 (Qt6)
- **图片处理**：Pillow (PIL)
- **多进程处理**：concurrent.futures.ProcessPoolExecutor
- **打包工具**：PyInstaller
- **编程语言**：Python 3.8+

## 🚀 性能优化

### 多进程处理优势
- **🔥 显著提速**：在多核CPU上可获得2-4倍的性能提升
- **⚡ 智能调度**：自动根据CPU核心数分配工作进程
- **🛡️ 稳定可靠**：单个进程异常不影响整体处理
- **🔄 自动回退**：多进程失败时自动切换到单进程模式

### 性能建议
- **大批量处理**：推荐使用多进程模式
- **小文件处理**：单进程模式可能更快（避免进程创建开销）
- **进程数设置**：默认为CPU核心数的一半，可根据需要调整（最多不超过16个）
- **内存考虑**：处理大图片时适当减少进程数

## 📦 打包说明

### 普通版本打包
```bash
pyinstaller 图片尺寸调整工具_极简版.spec
```

### 多进程版本打包
由于多进程在PyInstaller打包后可能遇到问题，我们提供了专门的解决方案：

#### 使用专用打包脚本（推荐）
```bash
python build_multiprocess.py
```

#### 手动打包
```bash
pyinstaller --onefile --windowed --name=图片尺寸调整工具_多进程版 ^
    --hidden-import=multiprocessing ^
    --hidden-import=multiprocessing.spawn ^
    --hidden-import=multiprocessing.pool ^
    --hidden-import=concurrent.futures ^
    --optimize=0 --noupx main.py
```

### 多进程打包问题解决

#### 常见问题
1. **exe无法启动多进程**: 缺少`multiprocessing.freeze_support()`
2. **子进程找不到模块**: 需要添加`--hidden-import`参数
3. **进程间通信失败**: 避免使用`--optimize=2`优化

#### 解决方案
- ✅ 在`main.py`中添加了`multiprocessing.freeze_support()`
- ✅ 创建了专用的`.spec`配置文件
- ✅ 增强了工作函数的模块导入
- ✅ 提供了多进程功能测试脚本

#### 测试多进程功能
打包完成后，可以运行测试脚本验证：
```bash
python test_multiprocess.py
```

### 注意事项
- 首次运行打包后的exe可能需要较长初始化时间
- Windows防火墙可能会询问网络权限，选择允许即可
- 如果多进程功能异常，程序会自动切换到单进程模式

## 📦 EXE 打包

项目提供了优化的打包脚本，可生成独立的 EXE 文件：

```bash
# 运行打包脚本
python build_exe.py

# 选择打包模式：
# 1. 🚀 标准优化版 (推荐) - 平衡体积和兼容性
# 2. 📦 极简版 - 追求最小体积
# 3. 📊 全部打包并对比 - 生成两个版本并对比
```

详细打包说明请参考：[📚 打包优化指南](打包优化指南.md)

## 🎯 界面预览

```
┌─────────────────────────────────────────────────────────┐
│                🖼️ 批量图片尺寸调整工具                    │
├─────────────────┬───────────────────────────────────────┤
│   📋 控制面板    │            📊 预览面板                │
│                │                                       │
│ ┌─📁 文件选择──┐ │ ┌─📄 文件列表─┬─📝 处理日志─┐          │
│ │ 🎯 拖放区域  │ │ │            │            │          │
│ │ [选择文件]   │ │ │   表格显示   │   实时日志   │          │
│ │ [选择文件夹] │ │ │   文件信息   │   处理状态   │          │
│ └─────────────┘ │ └────────────┴────────────┘          │
│                │                                       │
│ ┌─⚙️ 尺寸设置──┐ │                                       │
│ │ 宽度: [800] │ │                                       │
│ │ 高度: [600] │ │                                       │
│ │ 模式: [选择] │ │                                       │
│ │ 质量: [90%] │ │                                       │
│ └─────────────┘ │                                       │
│                │                                       │
│ ┌─📂 输出设置──┐ │                                       │
│ │ [选择目录]   │ │                                       │
│ └─────────────┘ │                                       │
├─────────────────┴───────────────────────────────────────┤
│              🎮 控制面板                                │
│         [████████] [🚀 开始处理] [❌ 取消]               │
└─────────────────────────────────────────────────────────┘
```

## ⚠️ 注意事项

- 📦 处理大量图片时请确保有足够的磁盘空间
- 💾 建议在处理前备份原始图片
- 🏷️ 输出文件自动添加 "_resized" 后缀，避免覆盖原文件
- 🖱️ 支持拖拽操作，可直接将文件或文件夹拖到程序中
- 🔄 处理过程中可随时取消操作

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🔗 相关链接

- [PySide6 官方文档](https://doc.qt.io/qtforpython/)
- [Pillow 文档](https://pillow.readthedocs.io/)
- [PyInstaller 文档](https://pyinstaller.readthedocs.io/)

---

<div align="center">

**如果这个项目对你有帮助，请给它一个 ⭐ Star！**

Made with ❤️ by Python & PySide6

</div>